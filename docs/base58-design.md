# Base58 编码设计文档

## 概述

Base58 是一种用于表示大整数的编码方式，常用于各种加密货币（如比特币）的地址和其他需要短且易于阅读的标识符。它使用58个字符（0-9，A-Z，a-z，去掉了0，O，I和l）来表示整数。

在短链接应用场景下，我们可以使用 Base58 编码来生成短链接。我们的实现中，我们将一个 `uint64` 类型的数字编码为 base58 字符串，其中 1～8位 58 进制可以表示的数字范围为：
```
58^1 = 58
58^2 = 3364
58^3 = 195112
58^4 = 11316496
58^5 = 656356768
58^6 = 38068692544
58^7 = 2216436115296
58^8 = 128063081718016
```

即 6位 base58 编码可以表示的数字范围为 656356769～38068692543，约为 364 亿，足够我们的短链接服务使用。

## 设计

在我们的实现中，我们提供了两个主要的函数：`Base58Encode` 和 `Base58Decode`。

### Base58Encode

`Base58Encode` 函数接受一个 `uint64` 类型的数字作为输入，返回一个 base58 编码的字节数组。它首先创建一个空的字节数组，然后在一个循环中，将输入数字除以58，将余数添加到字节数组中，然后更新输入数字为商。最后，它将字节数组反转，因为我们是从最低有效位开始添加的。

### Base58Decode

`Base58Decode` 函数接受一个 base58 编码的字节数组作为输入，返回解码后的 `uint64` 类型的数字和一个可能的错误。它首先检查输入字节数组的长度是否超过了最大字节数。然后，它在一个循环中，将每个字符的索引乘以58的相应次方，然后将结果累加到总数中。如果在这个过程中遇到了无效的字符，它将返回一个错误。

## 错误处理

我们的实现中有两种可能的错误：`ErrBase58Overflow` 和 `ErrorInvalidCharacter`。`ErrBase58Overflow` 错误表示输入的数字太大，无法解码。`ErrorInvalidCharacter` 错误表示输入的字节数组中包含无效的字符。

## 性能优化

为了提高性能，我们预计算了58的前9个幂，并将结果存储在 `pow58` 数组中。我们还创建了一个 `indices` 数组，用于快速查找字符在 base58 字母表中的索引。

## 测试

我们为每个函数编写了单元测试，以确保它们的正确性。我们还编写了基准测试，以测量函数的性能。

## 使用

要使用这个包，只需导入它，然后调用 `Base58Encode` 或 `Base58Decode` 函数。例如：

```go
num := uint64(123456789)
encoded := Base58Encode(num)
decoded, err := Base58Decode(encoded)
if err != nil {
    log.Fatal(err)
}
fmt.Println(decoded) // 输出: 123456789
```